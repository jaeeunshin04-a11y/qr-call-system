<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìš”ì²­í•˜ê¸°</title>
<style>
  body { font-family: Arial; padding: 20px; }
  .btn { 
    padding: 15px; margin: 10px 0; width: 100%; 
    font-size: 18px; border: none; border-radius: 12px;
    background:#4a6cf7; color:white; 
  }
  #msg { margin-top: 20px; font-size: 17px; font-weight: 600; color:#333; }
</style>
</head>
<body>

<h2>ê°„í˜¸ì‚¬ í˜¸ì¶œ ìš”ì²­</h2>

<!-- ìš”ì²­ ë²„íŠ¼ë“¤ -->
<button class="btn" onclick="sendRequest('ë¬¼ ìš”ì²­')">ë¬¼ ìš”ì²­</button>
<button class="btn" onclick="sendRequest('ì²´ìœ„ ë³€ê²½')">ì²´ìœ„ ë³€ê²½</button>
<button class="btn" onclick="sendRequest('ìˆ˜ì•¡ ê´€ë ¨')">ìˆ˜ì•¡ ê´€ë ¨</button>
<button class="btn" onclick="sendRequest('í†µì¦')">í†µì¦</button>

<h3>ê¸°íƒ€ ìš”ì²­</h3>
<input type="text" id="etcInput" placeholder="ê¸°íƒ€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:100%;padding:10px;margin-bottom:10px;">
<button class="btn" onclick="sendEtc()">ê¸°íƒ€ ìš”ì²­ ë³´ë‚´ê¸°</button>

<div id="msg"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyk9V6WkZEFyF4AJjg2eIHQ7KlN_nRaHV-V7D5x7cmBH0HJePExQu_VhznBGuAvcln3/exec";
const PATIENT_ID = "101";

// ìš”ì²­ ë²„íŠ¼
function sendRequest(type){
  sendToServer(type, "");
}

// ê¸°íƒ€ ìš”ì²­
function sendEtc(){
  const etc = document.getElementById("etcInput").value.trim();
  if(!etc){
    document.getElementById("msg").innerHTML = "âš  ê¸°íƒ€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
    return;
  }
  sendToServer("ê¸°íƒ€", etc);
}

// ì„œë²„ë¡œ ì „ì†¡
function sendToServer(type, etcText){
  document.getElementById("msg").innerHTML = "â³ ìš”ì²­ì„ ì „ì†¡í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...";

  fetch(`${SCRIPT_URL}?patientId=${PATIENT_ID}&type=${encodeURIComponent(type)}&etc=${encodeURIComponent(etcText)}`)
    .then(res => res.text())
    .then(()=>{
      document.getElementById("msg").innerHTML = "âœ” ìš”ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.";
      checkConfirmStatus();
    })
    .catch(()=>{
      document.getElementById("msg").innerHTML = "âš  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
    });
}

// ìƒíƒœ í™•ì¸
function checkConfirmStatus(){
  const interval = setInterval(()=>{
    fetch(`${SCRIPT_URL}?mode=getStatus&patientId=${PATIENT_ID}`)
      .then(res=>res.json())
      .then(data=>{
        if(data.status === "í™•ì¸ë¨"){
          document.getElementById("msg").innerHTML = "ğŸ‘©â€âš•ï¸ ê°„í˜¸ì‚¬ê°€ ìš”ì²­ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.";
        } 
        else if(data.status === "ì™„ë£Œ"){
          document.getElementById("msg").innerHTML = "âœ” ìš”ì²­ì´ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•„ìš” ì‹œ ë‹¤ì‹œ ìš”ì²­í•´ì£¼ì„¸ìš”.";
          clearInterval(interval);
        }
      });
  }, 3000); // 3ì´ˆë§ˆë‹¤ í™•ì¸
}
</script>

</body>
</html>
